service: kookmin-feed-crawling-server

provider:
  name: aws
  runtime: python3.11
  region: ap-northeast-2
  profile: kookmin-feed
  timeout: 30
  memorySize: 512
  stage: ${opt:stage, 'dev'}

  role: arn:aws:iam::558793517018:role/kookmin-feed-crawling-lambdaRole

  environment:
    STAGE: ${self:provider.stage}
    MONGODB_URI: ${file(envs/config.${self:provider.stage, 'dev'}.json):MONGODB_URI}
    DB_NAME: ${file(envs/config.${self:provider.stage, 'dev'}.json):DB_NAME}
    SLACK_BOT_TOKEN: ${file(envs/config.${self:provider.stage, 'dev'}.json):SLACK_BOT_TOKEN}
    SLACK_CHANNEL_ID: ${file(envs/config.${self:provider.stage, 'dev'}.json):SLACK_CHANNEL_ID}

# Docker ê¸°ë°˜ ë°°í¬ë¥¼ ìœ„í•œ Custom ì„¤ì •
custom:
  ecrRepositoryName: kookmin-feed-crawling-server
  accountId: 558793517018
  libraryGeneralImage: library-general-${self:provider.stage}

package:
  individually: false
  patterns:
    - 'common_utils.py'
    - 'master_handler.py'
    - 'master_utils.py'
    - 'metadata/**'
    - 'lambda_web_scraper/**'
    - '!node_modules/**'
    - '!package*.json'
    - '!README.md'
    - '!legacy_web_scraper/**'
    - '!layer/**'
    - '!envs/**'
    - '!.git/**'
    - '!.gitignore'
    - '!requirements.txt'
    - '!.vscode/**'
    - '!__pycache__/**'
    - '!**/__pycache__/**'

layers:
  ScraperDependencies:
    path: layer
    name: scraper-dependencies
    description: "ì›¹ ìŠ¤í¬ë˜í¼ìš© ê³µí†µ Python ì˜ì¡´ì„± (bs4, aiohttp, pymongo, pytz, feedparser)"
    compatibleRuntimes:
      - python3.11

functions:
  # Master í•¨ìˆ˜
  master:
    name: ${self:provider.stage}-master
    handler: master_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }
    events:
      - schedule:
          # AWS EventBridge Schedulerë¥¼ ì‚¬ìš©í•˜ë„ë¡ ëª…ì‹œ
          method: scheduler
          # ì›”~ê¸ˆ, 8ì‹œ ë¶€í„° 20ì‹œ ê¹Œì§€ ë§¤ 20ë¶„ ê°„ê²© ì„¤ì •
          rate: cron(0/20 8-20 ? * MON-FRI *)
          # í•œêµ­ì‹œê°„ ê¸°ì¤€
          timezone: Asia/Seoul
          enabled: true

  # University Academic ìŠ¤í¬ë˜í¼
  university_academic_scraper:
    name: ${self:provider.stage}-university_academic_scraper
    handler: lambda_web_scraper.university_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Business Administration Academic RSS ìŠ¤í¬ë˜í¼
  businessadministration_academic_rss_scraper:
    name: ${self:provider.stage}-businessadministration_academic_rss_scraper
    handler: lambda_web_scraper.businessadministration_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Special Lecture ìŠ¤í¬ë˜í¼
  university_speciallecture_scraper:
    name: ${self:provider.stage}-university_speciallecture_scraper
    handler: lambda_web_scraper.university_speciallecture_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Scholarship ìŠ¤í¬ë˜í¼
  university_scholarship_scraper:
    name: ${self:provider.stage}-university_scholarship_scraper
    handler: lambda_web_scraper.university_scholarship_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Contest Event ìŠ¤í¬ë˜í¼
  university_contestevent_scraper:
    name: ${self:provider.stage}-university_contestevent_scraper
    handler: lambda_web_scraper.university_contestevent_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Software Centered Academic ìŠ¤í¬ë˜í¼
  softwarecentered_academic_scraper:
    name: ${self:provider.stage}-softwarecentered_academic_scraper
    handler: lambda_web_scraper.softwarecentered_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Sociology Academic ìŠ¤í¬ë˜í¼
  socialscience_sociology_academic_scraper:
    name: ${self:provider.stage}-socialscience_sociology_academic_scraper
    handler: lambda_web_scraper.socialscience_sociology_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # COSS Academic ìŠ¤í¬ë˜í¼
  coss_academic_scraper:
    name: ${self:provider.stage}-coss_academic_scraper
    handler: lambda_web_scraper.coss_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Public Administration Academic ìŠ¤í¬ë˜í¼
  socialscience_publicadministration_academic_scraper:
    name: ${self:provider.stage}-socialscience_publicadministration_academic_scraper
    handler: lambda_web_scraper.socialscience_publicadministration_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Political Science Academic ìŠ¤í¬ë˜í¼
  socialscience_politicalscience_academic_scraper:
    name: ${self:provider.stage}-socialscience_politicalscience_academic_scraper
    handler: lambda_web_scraper.socialscience_politicalscience_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Education Academic ìŠ¤í¬ë˜í¼
  socialscience_education_academic_scraper:
    name: ${self:provider.stage}-socialscience_education_academic_scraper
    handler: lambda_web_scraper.socialscience_education_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Communication Media Academic ìŠ¤í¬ë˜í¼
  socialscience_communication_media_academic_scraper:
    name: ${self:provider.stage}-socialscience_communication_media_academic_scraper
    handler: lambda_web_scraper.socialscience_communication_media_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Communication Advertising Academic ìŠ¤í¬ë˜í¼
  socialscience_communication_advertising_academic_scraper:
    name: ${self:provider.stage}-socialscience_communication_advertising_academic_scraper
    handler: lambda_web_scraper.socialscience_communication_advertising_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Academic ìŠ¤í¬ë˜í¼
  socialscience_academic_scraper:
    name: ${self:provider.stage}-socialscience_academic_scraper
    handler: lambda_web_scraper.socialscience_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Science Technology Security Academic ìŠ¤í¬ë˜í¼
  sciencetechnology_security_academic_scraper:
    name: ${self:provider.stage}-sciencetechnology_security_academic_scraper
    handler: lambda_web_scraper.sciencetechnology_security_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Science Technology Chemistry Academic ìŠ¤í¬ë˜í¼
  sciencetechnology_chemistry_academic_scraper:
    name: ${self:provider.stage}-sciencetechnology_chemistry_academic_scraper
    handler: lambda_web_scraper.sciencetechnology_chemistry_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Physical Education Academic ìŠ¤í¬ë˜í¼
  physicaleducation_academic_scraper:
    name: ${self:provider.stage}-physicaleducation_academic_scraper
    handler: lambda_web_scraper.physicaleducation_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Architecture Academic ìŠ¤í¬ë˜í¼
  architecture_academic_scraper:
    name: ${self:provider.stage}-architecture_academic_scraper
    handler: lambda_web_scraper.architecture_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Arts Academic ìŠ¤í¬ë˜í¼
  arts_academic_scraper:
    name: ${self:provider.stage}-arts_academic_scraper
    handler: lambda_web_scraper.arts_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Automative Engineering Academic ìŠ¤í¬ë˜í¼
  automativeengineering_academic_scraper:
    name: ${self:provider.stage}-automativeengineering_academic_scraper
    handler: lambda_web_scraper.automativeengineering_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Advanced Materials Academic ìŠ¤í¬ë˜í¼
  creativeengineering_advancedmaterials_academic_scraper:
    name: ${self:provider.stage}-creativeengineering_advancedmaterials_academic_scraper
    handler: lambda_web_scraper.creativeengineering_advancedmaterials_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Civil Academic ìŠ¤í¬ë˜í¼
  creativeengineering_civil_academic_scraper:
    name: ${self:provider.stage}-creativeengineering_civil_academic_scraper
    handler: lambda_web_scraper.creativeengineering_civil_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Mechanical Academic ìŠ¤í¬ë˜í¼
  creativeengineering_mechanical_academic_scraper:
    name: ${self:provider.stage}-creativeengineering_mechanical_academic_scraper
    handler: lambda_web_scraper.creativeengineering_mechanical_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Automotive Academic ìŠ¤í¬ë˜í¼
  design_automotive_academic_scraper:
    name: ${self:provider.stage}-design_automotive_academic_scraper
    handler: lambda_web_scraper.design_automotive_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Ceramics Academic ìŠ¤í¬ë˜í¼
  design_ceramics_academic_scraper:
    name: ${self:provider.stage}-design_ceramics_academic_scraper
    handler: lambda_web_scraper.design_ceramics_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Industrial Academic ìŠ¤í¬ë˜í¼
  design_industrial_academic_scraper:
    name: ${self:provider.stage}-design_industrial_academic_scraper
    handler: lambda_web_scraper.design_industrial_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Metalwork Academic ìŠ¤í¬ë˜í¼
  design_metalwork_academic_scraper:
    name: ${self:provider.stage}-design_metalwork_academic_scraper
    handler: lambda_web_scraper.design_metalwork_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Visual Academic ìŠ¤í¬ë˜í¼
  design_visual_academic_scraper:
    name: ${self:provider.stage}-design_visual_academic_scraper
    handler: lambda_web_scraper.design_visual_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Future Mobility Academic ìŠ¤í¬ë˜í¼
  futuremobility_academic_scraper:
    name: ${self:provider.stage}-futuremobility_academic_scraper
    handler: lambda_web_scraper.futuremobility_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Eurasian Academic ìŠ¤í¬ë˜í¼
  globalhumanities_eurasian_academic_scraper:
    name: ${self:provider.stage}-globalhumanities_eurasian_academic_scraper
    handler: lambda_web_scraper.globalhumanities_eurasian_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Law Academic ìŠ¤í¬ë˜í¼
  law_academic_scraper:
    name: ${self:provider.stage}-law_academic_scraper
    handler: lambda_web_scraper.law_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # LINC Academic ìŠ¤í¬ë˜í¼
  linc_academic_scraper:
    name: ${self:provider.stage}-linc_academic_scraper
    handler: lambda_web_scraper.linc_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # NCCOSS General ìŠ¤í¬ë˜í¼
  nccoss_general_scraper:
    name: ${self:provider.stage}-nccoss_general_scraper
    handler: lambda_web_scraper.nccoss_general_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Computer Science Academic RSS ìŠ¤í¬ë˜í¼
  computerscience_academic_rss_scraper:
    name: ${self:provider.stage}-computerscience_academic_rss_scraper
    handler: lambda_web_scraper.computerscience_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Electrical Academic RSS ìŠ¤í¬ë˜í¼
  creativeengineering_electrical_academic_rss_scraper:
    name: ${self:provider.stage}-creativeengineering_electrical_academic_rss_scraper
    handler: lambda_web_scraper.creativeengineering_electrical_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Korean History Academic RSS ìŠ¤í¬ë˜í¼
  globalhumanities_koreanhistory_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_koreanhistory_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_koreanhistory_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Dormitory General RSS ìŠ¤í¬ë˜í¼
  dormitory_general_rss_scraper:
    name: ${self:provider.stage}-dormitory_general_rss_scraper
    handler: lambda_web_scraper.dormitory_general_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Economic Commerce Academic RSS ìŠ¤í¬ë˜í¼
  economiccommerce_academic_rss_scraper:
    name: ${self:provider.stage}-economiccommerce_academic_rss_scraper
    handler: lambda_web_scraper.economiccommerce_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Academic RSS ìŠ¤í¬ë˜í¼
  creativeengineering_academic_rss_scraper:
    name: ${self:provider.stage}-creativeengineering_academic_rss_scraper
    handler: lambda_web_scraper.creativeengineering_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Culture Academic RSS ìŠ¤í¬ë˜í¼
  culture_academic_rss_scraper:
    name: ${self:provider.stage}-culture_academic_rss_scraper
    handler: lambda_web_scraper.culture_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Teaching Academic RSS ìŠ¤í¬ë˜í¼
  teaching_academic_rss_scraper:
    name: ${self:provider.stage}-teaching_academic_rss_scraper
    handler: lambda_web_scraper.teaching_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Academic RSS ìŠ¤í¬ë˜í¼
  globalhumanities_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Korean Academic RSS ìŠ¤í¬ë˜í¼
  globalhumanities_korean_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_korean_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_korean_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities English Academic RSS ìŠ¤í¬ë˜í¼
  globalhumanities_english_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_english_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_english_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Chinese Academic RSS ìŠ¤í¬ë˜í¼
  globalhumanities_chinese_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_chinese_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_chinese_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Bukak Political Forum ìŠ¤í¬ë˜í¼
  university_bukakpoliticalforum_scraper:
    name: ${self:provider.stage}-university_bukakpoliticalforum_scraper
    handler: lambda_web_scraper.university_bukakpoliticalforum_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Thursday Lecture ìŠ¤í¬ë˜í¼
  university_thursdaylecture_scraper:
    name: ${self:provider.stage}-university_thursdaylecture_scraper
    handler: lambda_web_scraper.university_thursdaylecture_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Climate Change Academic ìŠ¤í¬ë˜í¼
  climatechange_academic_scraper:
    name: ${self:provider.stage}-climatechange_academic_scraper
    handler: lambda_web_scraper.climatechange_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # ğŸ³ Library General ìŠ¤í¬ë˜í¼ (Container Image ì‚¬ìš© - Playwright ì§€ì›)
  library_general_scraper:
    name: ${self:provider.stage}-library_general_scraper
    image:
      uri: ${self:custom.accountId}.dkr.ecr.${self:provider.region}.amazonaws.com/${self:custom.ecrRepositoryName}:${self:custom.libraryGeneralImage}
    timeout: 120
    memorySize: 3008
