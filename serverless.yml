service: kookmin-feed-crawling-server

provider:
  name: aws
  runtime: python3.11
  region: ap-northeast-2
  profile: kookmin-feed
  timeout: 30
  memorySize: 512
  stage: ${opt:stage, 'dev'}

  role: arn:aws:iam::558793517018:role/kookmin-feed-crawling-lambdaRole

  environment:
    STAGE: ${self:provider.stage}
    MONGODB_URI: ${file(envs/config.${self:provider.stage, 'dev'}.json):MONGODB_URI}
    DB_NAME: ${file(envs/config.${self:provider.stage, 'dev'}.json):DB_NAME}
    SLACK_BOT_TOKEN: ${file(envs/config.${self:provider.stage, 'dev'}.json):SLACK_BOT_TOKEN}
    SLACK_CHANNEL_ID: ${file(envs/config.${self:provider.stage, 'dev'}.json):SLACK_CHANNEL_ID}

package:
  individually: false
  patterns:
    - 'common_utils.py'
    - 'master_handler.py'
    - 'master_utils.py'
    - 'metadata/**'
    - 'lambda_web_scraper/**'
    - '!node_modules/**'
    - '!package*.json'
    - '!README.md'
    - '!legacy_web_scraper/**'
    - '!layer/**'
    - '!envs/**'
    - '!.git/**'
    - '!.gitignore'
    - '!requirements.txt'
    - '!.vscode/**'
    - '!__pycache__/**'
    - '!**/__pycache__/**'

layers:
  ScraperDependencies:
    path: layer
    name: scraper-dependencies
    description: "웹 스크래퍼용 공통 Python 의존성 (bs4, aiohttp, pymongo, pytz, feedparser)"
    compatibleRuntimes:
      - python3.11

functions:
  # Master 함수
  master:
    name: ${self:provider.stage}-master
    handler: master_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }
    events:
      - schedule:
          # AWS EventBridge Scheduler를 사용하도록 명시
          method: scheduler
          # 월~금, 8시 부터 20시 까지 매 20분 간격 설정
          rate: cron(0/20 8-20 ? * MON-FRI *)
          # 한국시간 기준
          timezone: Asia/Seoul
          enabled: true

  # University Academic 스크래퍼
  university_academic_scraper:
    name: ${self:provider.stage}-university_academic_scraper
    handler: lambda_web_scraper.university_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Business Administration Academic RSS 스크래퍼
  businessadministration_academic_rss_scraper:
    name: ${self:provider.stage}-businessadministration_academic_rss_scraper
    handler: lambda_web_scraper.businessadministration_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Special Lecture 스크래퍼
  university_speciallecture_scraper:
    name: ${self:provider.stage}-university_speciallecture_scraper
    handler: lambda_web_scraper.university_speciallecture_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Scholarship 스크래퍼
  university_scholarship_scraper:
    name: ${self:provider.stage}-university_scholarship_scraper
    handler: lambda_web_scraper.university_scholarship_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Contest Event 스크래퍼
  university_contestevent_scraper:
    name: ${self:provider.stage}-university_contestevent_scraper
    handler: lambda_web_scraper.university_contestevent_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Software Centered Academic 스크래퍼
  softwarecentered_academic_scraper:
    name: ${self:provider.stage}-softwarecentered_academic_scraper
    handler: lambda_web_scraper.softwarecentered_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Sociology Academic 스크래퍼
  socialscience_sociology_academic_scraper:
    name: ${self:provider.stage}-socialscience_sociology_academic_scraper
    handler: lambda_web_scraper.socialscience_sociology_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # COSS Academic 스크래퍼
  coss_academic_scraper:
    name: ${self:provider.stage}-coss_academic_scraper
    handler: lambda_web_scraper.coss_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Public Administration Academic 스크래퍼
  socialscience_publicadministration_academic_scraper:
    name: ${self:provider.stage}-socialscience_publicadministration_academic_scraper
    handler: lambda_web_scraper.socialscience_publicadministration_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Political Science Academic 스크래퍼
  socialscience_politicalscience_academic_scraper:
    name: ${self:provider.stage}-socialscience_politicalscience_academic_scraper
    handler: lambda_web_scraper.socialscience_politicalscience_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Education Academic 스크래퍼
  socialscience_education_academic_scraper:
    name: ${self:provider.stage}-socialscience_education_academic_scraper
    handler: lambda_web_scraper.socialscience_education_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Communication Media Academic 스크래퍼
  socialscience_communication_media_academic_scraper:
    name: ${self:provider.stage}-socialscience_communication_media_academic_scraper
    handler: lambda_web_scraper.socialscience_communication_media_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Communication Advertising Academic 스크래퍼
  socialscience_communication_advertising_academic_scraper:
    name: ${self:provider.stage}-socialscience_communication_advertising_academic_scraper
    handler: lambda_web_scraper.socialscience_communication_advertising_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Academic 스크래퍼
  socialscience_academic_scraper:
    name: ${self:provider.stage}-socialscience_academic_scraper
    handler: lambda_web_scraper.socialscience_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Science Technology Security Academic 스크래퍼
  sciencetechnology_security_academic_scraper:
    name: ${self:provider.stage}-sciencetechnology_security_academic_scraper
    handler: lambda_web_scraper.sciencetechnology_security_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Science Technology Chemistry Academic 스크래퍼
  sciencetechnology_chemistry_academic_scraper:
    name: ${self:provider.stage}-sciencetechnology_chemistry_academic_scraper
    handler: lambda_web_scraper.sciencetechnology_chemistry_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Physical Education Academic 스크래퍼
  physicaleducation_academic_scraper:
    name: ${self:provider.stage}-physicaleducation_academic_scraper
    handler: lambda_web_scraper.physicaleducation_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Architecture Academic 스크래퍼
  architecture_academic_scraper:
    name: ${self:provider.stage}-architecture_academic_scraper
    handler: lambda_web_scraper.architecture_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Arts Academic 스크래퍼
  arts_academic_scraper:
    name: ${self:provider.stage}-arts_academic_scraper
    handler: lambda_web_scraper.arts_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Automative Engineering Academic 스크래퍼
  automativeengineering_academic_scraper:
    name: ${self:provider.stage}-automativeengineering_academic_scraper
    handler: lambda_web_scraper.automativeengineering_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Advanced Materials Academic 스크래퍼
  creativeengineering_advancedmaterials_academic_scraper:
    name: ${self:provider.stage}-creativeengineering_advancedmaterials_academic_scraper
    handler: lambda_web_scraper.creativeengineering_advancedmaterials_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Civil Academic 스크래퍼
  creativeengineering_civil_academic_scraper:
    name: ${self:provider.stage}-creativeengineering_civil_academic_scraper
    handler: lambda_web_scraper.creativeengineering_civil_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Mechanical Academic 스크래퍼
  creativeengineering_mechanical_academic_scraper:
    name: ${self:provider.stage}-creativeengineering_mechanical_academic_scraper
    handler: lambda_web_scraper.creativeengineering_mechanical_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Automotive Academic 스크래퍼
  design_automotive_academic_scraper:
    name: ${self:provider.stage}-design_automotive_academic_scraper
    handler: lambda_web_scraper.design_automotive_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Ceramics Academic 스크래퍼
  design_ceramics_academic_scraper:
    name: ${self:provider.stage}-design_ceramics_academic_scraper
    handler: lambda_web_scraper.design_ceramics_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Industrial Academic 스크래퍼
  design_industrial_academic_scraper:
    name: ${self:provider.stage}-design_industrial_academic_scraper
    handler: lambda_web_scraper.design_industrial_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Metalwork Academic 스크래퍼
  design_metalwork_academic_scraper:
    name: ${self:provider.stage}-design_metalwork_academic_scraper
    handler: lambda_web_scraper.design_metalwork_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Design Visual Academic 스크래퍼
  design_visual_academic_scraper:
    name: ${self:provider.stage}-design_visual_academic_scraper
    handler: lambda_web_scraper.design_visual_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Future Mobility Academic 스크래퍼
  futuremobility_academic_scraper:
    name: ${self:provider.stage}-futuremobility_academic_scraper
    handler: lambda_web_scraper.futuremobility_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Eurasian Academic 스크래퍼
  globalhumanities_eurasian_academic_scraper:
    name: ${self:provider.stage}-globalhumanities_eurasian_academic_scraper
    handler: lambda_web_scraper.globalhumanities_eurasian_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Law Academic 스크래퍼
  law_academic_scraper:
    name: ${self:provider.stage}-law_academic_scraper
    handler: lambda_web_scraper.law_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # LINC Academic 스크래퍼
  linc_academic_scraper:
    name: ${self:provider.stage}-linc_academic_scraper
    handler: lambda_web_scraper.linc_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # NCCOSS General 스크래퍼
  nccoss_general_scraper:
    name: ${self:provider.stage}-nccoss_general_scraper
    handler: lambda_web_scraper.nccoss_general_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Computer Science Academic RSS 스크래퍼
  computerscience_academic_rss_scraper:
    name: ${self:provider.stage}-computerscience_academic_rss_scraper
    handler: lambda_web_scraper.computerscience_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Electrical Academic RSS 스크래퍼
  creativeengineering_electrical_academic_rss_scraper:
    name: ${self:provider.stage}-creativeengineering_electrical_academic_rss_scraper
    handler: lambda_web_scraper.creativeengineering_electrical_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Korean History Academic RSS 스크래퍼
  globalhumanities_koreanhistory_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_koreanhistory_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_koreanhistory_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Dormitory General RSS 스크래퍼
  dormitory_general_rss_scraper:
    name: ${self:provider.stage}-dormitory_general_rss_scraper
    handler: lambda_web_scraper.dormitory_general_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Economic Commerce Academic RSS 스크래퍼
  economiccommerce_academic_rss_scraper:
    name: ${self:provider.stage}-economiccommerce_academic_rss_scraper
    handler: lambda_web_scraper.economiccommerce_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Academic RSS 스크래퍼
  creativeengineering_academic_rss_scraper:
    name: ${self:provider.stage}-creativeengineering_academic_rss_scraper
    handler: lambda_web_scraper.creativeengineering_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Culture Academic RSS 스크래퍼
  culture_academic_rss_scraper:
    name: ${self:provider.stage}-culture_academic_rss_scraper
    handler: lambda_web_scraper.culture_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Teaching Academic RSS 스크래퍼
  teaching_academic_rss_scraper:
    name: ${self:provider.stage}-teaching_academic_rss_scraper
    handler: lambda_web_scraper.teaching_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Academic RSS 스크래퍼
  globalhumanities_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Korean Academic RSS 스크래퍼
  globalhumanities_korean_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_korean_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_korean_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities English Academic RSS 스크래퍼
  globalhumanities_english_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_english_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_english_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Global Humanities Chinese Academic RSS 스크래퍼
  globalhumanities_chinese_academic_rss_scraper:
    name: ${self:provider.stage}-globalhumanities_chinese_academic_rss_scraper
    handler: lambda_web_scraper.globalhumanities_chinese_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Bukak Political Forum 스크래퍼
  university_bukakpoliticalforum_scraper:
    name: ${self:provider.stage}-university_bukakpoliticalforum_scraper
    handler: lambda_web_scraper.university_bukakpoliticalforum_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Thursday Lecture 스크래퍼
  university_thursdaylecture_scraper:
    name: ${self:provider.stage}-university_thursdaylecture_scraper
    handler: lambda_web_scraper.university_thursdaylecture_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Climate Change Academic 스크래퍼
  climatechange_academic_scraper:
    name: ${self:provider.stage}-climatechange_academic_scraper
    handler: lambda_web_scraper.climatechange_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Library General 스크래퍼
  library_general_scraper:
    name: ${self:provider.stage}-library_general_scraper
    handler: lambda_web_scraper.library_general_handler.handler
    timeout: 90
    memorySize: 1536
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }
      - arn:aws:lambda:ap-northeast-2:764866452798:layer:playwright:28