service: kookmin-feed-crawling-server

provider:
  name: aws
  runtime: python3.11
  region: ap-northeast-2
  profile: kookmin-feed
  timeout: 30
  memorySize: 512
  iam:
    role:
      statements:
        - Effect: Allow
          Action: "*"
          Resource: "*"
  environment:
    MONGODB_URI: ${file(envs/config.${self:provider.stage, 'dev'}.json):MONGODB_URI}
    DB_NAME: ${file(envs/config.${self:provider.stage, 'dev'}.json):DB_NAME}
    SLACK_BOT_TOKEN: ${file(envs/config.${self:provider.stage, 'dev'}.json):SLACK_BOT_TOKEN}
    SLACK_CHANNEL_ID: ${file(envs/config.${self:provider.stage, 'dev'}.json):SLACK_CHANNEL_ID}

package:
  individually: false
  patterns:
    - 'common_utils.py'
    - 'master_handler.py'
    - 'master_utils.py'
    - 'metadata/**'
    - 'lambda_web_scraper/**'
    - '!node_modules/**'
    - '!package*.json'
    - '!README.md'
    - '!legacy_web_scraper/**'
    - '!layer/**'
    - '!envs/**'
    - '!.git/**'
    - '!.gitignore'
    - '!requirements.txt'
    - '!.vscode/**'
    - '!__pycache__/**'
    - '!**/__pycache__/**'

layers:
  ScraperDependencies:
    path: layer
    name: scraper-dependencies
    description: "웹 스크래퍼용 공통 Python 의존성 (bs4, aiohttp, pymongo, pytz, feedparser)"
    compatibleRuntimes:
      - python3.11

functions:
  # Master 함수
  master:
    name: master
    handler: master_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }
    events:
      - schedule:
          rate: rate(1 minute)
          enabled: true

  # University Academic 스크래퍼
  university_academic_scraper:
    name: university_academic_scraper
    handler: lambda_web_scraper.university_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Business Administration Academic RSS 스크래퍼
  businessadministration_academic_rss_scraper:
    name: businessadministration_academic_rss_scraper
    handler: lambda_web_scraper.businessadministration_academic_rss_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Special Lecture 스크래퍼
  university_speciallecture_scraper:
    name: university_speciallecture_scraper
    handler: lambda_web_scraper.university_speciallecture_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Scholarship 스크래퍼
  university_scholarship_scraper:
    name: university_scholarship_scraper
    handler: lambda_web_scraper.university_scholarship_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # University Contest Event 스크래퍼
  university_contestevent_scraper:
    name: university_contestevent_scraper
    handler: lambda_web_scraper.university_contestevent_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Software Centered Academic 스크래퍼
  softwarecentered_academic_scraper:
    name: softwarecentered_academic_scraper
    handler: lambda_web_scraper.softwarecentered_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Sociology Academic 스크래퍼
  socialscience_sociology_academic_scraper:
    name: socialscience_sociology_academic_scraper
    handler: lambda_web_scraper.socialscience_sociology_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # COSS Academic 스크래퍼
  coss_academic_scraper:
    name: coss_academic_scraper
    handler: lambda_web_scraper.coss_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Public Administration Academic 스크래퍼
  socialscience_publicadministration_academic_scraper:
    name: socialscience_publicadministration_academic_scraper
    handler: lambda_web_scraper.socialscience_publicadministration_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Political Science Academic 스크래퍼
  socialscience_politicalscience_academic_scraper:
    name: socialscience_politicalscience_academic_scraper
    handler: lambda_web_scraper.socialscience_politicalscience_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Social Science Education Academic 스크래퍼
  socialscience_education_academic_scraper:
    name: socialscience_education_academic_scraper
    handler: lambda_web_scraper.socialscience_education_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Architecture Academic 스크래퍼
  architecture_academic_scraper:
    name: architecture_academic_scraper
    handler: lambda_web_scraper.architecture_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Arts Academic 스크래퍼
  arts_academic_scraper:
    name: arts_academic_scraper
    handler: lambda_web_scraper.arts_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Automative Engineering Academic 스크래퍼
  automativeengineering_academic_scraper:
    name: automativeengineering_academic_scraper
    handler: lambda_web_scraper.automativeengineering_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }

  # Creative Engineering Advanced Materials Academic 스크래퍼
  creativeengineering_advancedmaterials_academic_scraper:
    name: creativeengineering_advancedmaterials_academic_scraper
    handler: lambda_web_scraper.creativeengineering_advancedmaterials_academic_handler.handler
    layers:
      - { Ref: ScraperDependenciesLambdaLayer }